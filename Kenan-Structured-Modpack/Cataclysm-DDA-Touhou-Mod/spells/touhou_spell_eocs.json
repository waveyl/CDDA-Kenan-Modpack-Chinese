[
  {
    "id": "dash_kokoro_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "u_cast_spell": { "id": "dash_kokoro2" }, "targeted": true },
      { "run_eocs": [ "dash_kokoro_aoe_eoc" ] }
    ]
  },
  {
    "id": "dash_kokoro_aoe_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "dash_kokoro3" }, "targeted": false }
    ]
  },
  {
    "id": "dash_mokou_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "run_eocs": [ "dash_mokou_dash_eoc" ] }
    ]
  },
  {
    "id": "dash_mokou_dash_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "dash_mokou3" }, "targeted": true }
    ]
  },
  {
    "id": "kaenbyou_blazingwheel_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "2" ] },
    "effect": [
      { "u_cast_spell": { "id": "kaenbyou_blazingwheel2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You don't have enough soulshards to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "150" ] }
    ],
    "//": "Self-explanatory. The soulshards are consumed after (automatically) chaining a spell EOC that runs kaenbyou_consume_soulshard_eoc or kaenbyou_consume_soulshard_2_eoc"
  },
  {
    "id": "kaenbyou_conflagrate_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_immolate", ">=", "1" ] },
    "effect": [
      { "math": [ "u_var_immolate", "=", "0" ] },
      { "u_cast_spell": { "id": "kaenbyou_conflagrate3" } }
    ],
    "//": "WIP. It works as it is, but the effects and stuff don't show for the player"
  },
  {
    "id": "kaenbyou_consume_soulshard_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "1" ] },
    "effect": [ { "math": [ "u_var_soulshard", "-=", "1" ] } ]
  },
  {
    "id": "kaenbyou_consume_soulshard_2_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "2" ] },
    "effect": [ { "math": [ "u_var_soulshard", "-=", "2" ] } ]
  },
  {
    "id": "kaenbyou_consume_soulshard_4_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "4" ] },
    "effect": [ { "math": [ "u_var_soulshard", "-=", "4" ] } ]
  },
  {
    "id": "kaenbyou_immolate_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_immolate", "+=", "1" ] }
    ]
  },
  {
    "id": "kaenbyou_soulfire_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "1" ] },
    "effect": [
      { "u_cast_spell": { "id": "kaenbyou_soulfire2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You don't have enough soulshards to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "133" ] }
    ]
  },
  {
    "id": "kaenbyou_soulshard_fuel_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "4" ] },
    "effect": [
      { "u_cast_spell": { "id": "kaenbyou_soulshard_fuel2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You don't have enough soulshards to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "50" ] }
    ]
  },
  {
    "id": "kaenbyou_soulshatter_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_soulshard", ">=", "1" ] },
    "effect": [
      { "u_cast_spell": { "id": "kaenbyou_soulshatter2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You don't have enough soulshards to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "50" ] }
    ]
  },
  {
    "id": "kokoro_backsweep_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "QUARTERSTAVES" },
        { "u_has_wielded_with_weapon_category": "SPEARS" },
        { "u_has_wielded_with_weapon_category": "POLEARMS" },
        { "u_has_wielded_with_weapon_category": "GREAT_AXES" }
      ]
    },
    "effect": [
      { "run_eocs": [ "kokoro_backsweep_check" ] }
    ],
    "false_effect": [ 
      { "u_message": "You don't have any 2h weapons equipped.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ],
    "//": "Simple EOC just checks if Kokoro is wielding any 2h, if she isn't the cast fails"
  },
  {
    "id": "kokoro_backsweep_check",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_cut_dmg" ] },
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_backsweep2_bash" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_backsweep_check2" ] } ]
  },
  {
    "id": "kokoro_backsweep_check2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_backsweep2_cut" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_backsweep_check3" ] } ]
  },
  {
    "id": "kokoro_backsweep_check3",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_cut_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_backsweep2_stab" }, "targeted": true }
    ]
  },
  {
    "id": "kokoro_quick_attack_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "BATONS" },
        { "u_has_wielded_with_weapon_category": "HAND_AXES" },
        { "u_has_wielded_with_weapon_category": "SHORT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "MEDIUM_SWORDS" },  
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "QUARTERSTAVES" },
        { "u_has_wielded_with_weapon_category": "SPEARS" },
        { "u_has_wielded_with_weapon_category": "POLEARMS" },
        { "u_has_wielded_with_weapon_category": "GREAT_AXES" }
      ]
    },
    "effect": [
      { "run_eocs": [ "kokoro_quick_attack_check" ] }
    ],
    "false_effect": [ 
      { "u_message": "You're not using any compatible weapons.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ],
    "//": "Simple EOC just checks if Kokoro is wielding any weapon allowed by her MA, if she isn't the cast fails"
  },
  {
    "id": "kokoro_quick_attack_check",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_cut_dmg" ] },
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_quick_attack2_bash" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_quick_attack_check2" ] } ]
  },
  {
    "id": "kokoro_quick_attack_check2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_quick_attack2_cut" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_quick_attack_check3" ] } ]
  },
  {
    "id": "kokoro_quick_attack_check3",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_cut_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_quick_attack2_stab" }, "targeted": true }
    ]
  },
  {
    "id": "kokoro_unleash_emotion_eoc",
    "type": "effect_on_condition",
    "effect": [
      {
        "run_eocs": [
          {
            "id": "kokoro_unleash_emotion_happiness",
            "condition": { "math": [ "var_kokoro_mask", "==", "0" ] },
            "effect": [
              { "math": [ "var_kokoro_instability", "-=", "60 + rand(60)" ] },
              { "u_cast_spell": { "id": "kokoro_unleash_emotion0" }, "targeted": false }
            ]
          },
          {
            "id": "kokoro_unleash_emotion_determination",
            "condition": { "math": [ "var_kokoro_mask", "==", "1" ] },
            "effect": [
              { "math": [ "var_kokoro_instability", "-=", "60 + rand(60)" ] },
              { "u_cast_spell": { "id": "kokoro_unleash_emotion1" }, "targeted": false }
            ]
          },
          {
            "id": "kokoro_unleash_emotion_melancholy",
            "condition": { "math": [ "var_kokoro_mask", "==", "2" ] },
            "effect": [
              { "math": [ "var_kokoro_instability", "-=", "60 + rand(60)" ] },
              { "u_cast_spell": { "id": "kokoro_unleash_emotion2" }, "targeted": false }
            ]
          },
          {
            "id": "kokoro_unleash_emotion_anger",
            "condition": { "math": [ "var_kokoro_mask", "==", "3" ] },
            "effect": [
              { "math": [ "var_kokoro_instability", "-=", "60 + rand(60)" ] },
              { "u_cast_spell": { "id": "kokoro_unleash_emotion3" }, "targeted": false }
            ]
          }
        ]
      }
    ]
  },
  {
    "id": "meiling_mountainbreak_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mountainbreakcasted", "=", "1" ] },
      { "run_eocs": [ "meiling_mountainbreak_check" ] },
      { "queue_eocs": [ "meiling_mountainbreak_timer" ], "time_in_future": "2 s" }
    ],
    "//": "When the spell is cast this sets the var to 1, runs the check and prepares the var to reset after 2 s"
  },
  {
    "id": "meiling_mountainbreak_check",
    "type": "effect_on_condition",
    "recurrence": "1 s",
    "condition": {
      "and": [
        { "math": [ "var_mountainbreakcasted", "==", "1" ] },
        { "math": [ "var_meilingblock", "==", "1" ] }
      ]
    },
    "deactivate_condition": { "math": [ "var_mountainbreakcasted", "==", "0" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "meiling_mountainbreak2" }, "targeted": true }
    ],
    "//": "The check is active only if: Meiling has cast the spell + she has blocked in the last 2 seconds, if so she will cast the damage component of the spell. The recurrence deactivates if the var is zero, so it doesn't run all the time"
  },
  {
    "id": "meiling_mountainbreak_timer",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mountainbreakcasted", "=", "0" ] }
    ],
    "//": "This is activated 2 s after Meiling gains the 'spell casted' var, window of opportunity"
  },
  {
    "id": "meiling_mountainbreak_timer2",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_meilingblock", "=", "0" ] }
    ],
    "//": "This is activated 2 s after Meiling gains the 'blocked' var, window of opportunity"
  },
  {
    "id": "mokou_combustion_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "run_eocs": [ "mokou_combustion_cycle1" ] }
    ],
    "//": "This EOC is a simplified version of utsuho_fissionaura_eoc "
  },
  {
    "id": "mokou_combustion_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_mokou_combustion", "<", "5" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "mokou_combustion2" }, "targeted": false },
      { "run_eocs": [ "mokou_combustion_cycle2" ] }
    ],
    "false_effect": [ { "math": [ "var_mokou_combustion", "=", "0" ] } ]
  },
  {
    "id": "mokou_combustion_cycle2",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mokou_combustion", "+=", "1" ] },
      { "math": [ "u_pain()", "-=", "2" ] },
      { "queue_eocs": [ "mokou_combustion_cycle1" ], "time_in_future": "3 s" }
    ]
  },
  {
    "id": "remilia_darkdrain2_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_remidrain", "=", "0" ] },
      {
        "run_eocs": [
          {
            "id": "remilia_darkdrain_human",
            "condition": {
              "or": [
                { "u_has_species": "FERAL" },
                { "u_has_species": "HUMAN" }
              ]
            },
            "effect": [ { "math": [ "var_remidrain", "=", "( (u_skill('stabbing') * 0.133 ) + (u_skill('melee') * 0.133 ) + (u_skill('dodge') * 0.133 ) + 2.404 )" ] } ]
          },
          {
            "id": "remilia_darkdrain_reduced",
            "condition": {
              "or": [
                { "u_has_flag": "ARTHROPOD_BLOOD" },
                { "u_has_species": "AMPHIBIAN" },
                { "u_has_species": "BIRD" },
                { "u_has_species": "CENTIPEDE" },
                { "u_has_species": "CYBORG" },
                { "u_has_species": "FISH" },
                { "u_has_species": "INSECT" },
                { "u_has_species": "INSECT_FLYING" },
                { "u_has_species": "KRAKEN" },
                { "u_has_species": "LEECH_PLANT" },
                { "u_has_species": "MAMMAL" },
                { "u_has_species": "MOLLUSK" },
                { "u_has_species": "MUTANT" },
                { "u_has_species": "PLANT" },
                { "u_has_species": "REPTILE" },
                { "u_has_species": "SPIDER" },
                { "u_has_species": "WORM" },
                { "u_has_species": "ZOMBIE" },
                { "u_has_trait": "BLEEDSLOW2" },
                { "u_has_trait": "INSECTBLOOD" },
                { "u_has_trait": "INVERTEBRATEBLOOD" },
                { "u_has_trait": "PLANTBLOOD" }
              ]
            },
            "effect": [ { "math": [ "var_remidrain", "=", "( ( (u_skill('stabbing') * 0.133 ) + (u_skill('melee') * 0.133 ) + (u_skill('dodge') * 0.133 ) + 2.404 ) * rng( 0.17, 0.66 ) )" ] } ]
          },
          {
            "id": "remilia_darkdrain_hazard",
            "condition": {
              "or": [
                { "u_has_flag": "ACID_BLOOD" },
                { "u_has_flag": "BILE_BLOOD" },
                { "u_has_flag": "DEADLY_VIRUS" },
                { "u_has_species": "FUNGUS" },
                { "u_has_species": "MIGO" },
                { "u_has_species": "NETHER" },
                { "u_has_trait": "ACIDBLOOD" }
              ]
            },
            "effect": [ { "math": [ "var_remidrain", "=", "( ( - (u_skill('stabbing') * 0.133 ) - (u_skill('melee') * 0.133 ) - (u_skill('dodge') * 0.133 ) - 2.404 ) * rng( 0.33, 0.5 ) )" ] } ]
          },
          {
            "id": "remilia_darkdrain_noblood",
            "condition": {
              "or": [
                { "u_has_species": "SLIME" },
                { "u_has_trait": "BLEED_IMMUNE" }
              ]
            },
            "effect": [ { "math": [ "var_remidrain", "=", "0" ] } ]
          }
        ]
      }
    ],
    "//": "Resets the var to 0 and checks for the species/traits of the target she's draining, and sets var -> sets less var -> sets negative var -> sets no var, accordingly to the blood they have"
  },
  {
    "id": "remilia_darkdrain3_eoc",
    "type": "effect_on_condition",
    "effect": [ { "queue_eocs": [ "remilia_darkdrain_heal" ], "time_in_future": "3 s" } ],
    "//": "This runs at the same time (shortly after) the previous EOC. It just delays the self-heal spell by 3 s"
  },
  {
    "id": "remilia_darkdrain_heal",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "remilia_darkdrain4" }, "targeted": false },
      { "math": [ "u_vitamin('hblood_vitamin')", "+=", "var_remidrain" ] }
    ]
  },
  {
    "id": "remilia_gungnir_dismiss_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "REMI_GUNGNIR_FLAG" },
    "effect": [
      { "math": [ "u_val('mana')", "+=", "100" ] },
      { "u_message": "You dismiss your Gungnir.", "type": "good" }
    ],
    "false_effect": [ 
      { "u_message": "You can't dismiss your Gungnir if you don't have it in your hand.", "type": "mixed" }
    ]
  },
  {
    "id": "sakuya_maidsecret_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_sakuyafocus", "+=", "1" ] },
      { "math": [ "var_sakuyaradius", "=", "( - (u_skill('stabbing') * 0.4 ) - (u_skill('dodge') * 0.4 ) + 16.8 )" ] },
      { "run_eocs": [ "sakuya_maidsecret_cycle1" ] }
    ],
    "//": "This EOC is a simplified version of udonge_waveinsight_start ",
    "//2": "var_sakuyaradius sets the detection radius to that formula, 14 - 6 tiles scaling down with higher (stabbing + dodge)"
  },
  {
    "id": "sakuya_maidsecret_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_sakuyafocus", "<", "2" ] },
    "effect": [ { "run_eocs": [ "sakuya_maidsecret_cycle2" ] } ],
    "false_effect": [
      { "math": [ "var_sakuyafocus", "=", "0" ] },
      { "u_lose_effect": "sakuya_maidsecret_effect" }
    ]
  },
  {
    "id": "sakuya_maidsecret_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "100" ] },
        { "math": [ "u_val('stamina')", ">=", "2000" ] },
        { "math": [ "var_sakuyafocus", ">", "0" ] },
        { "math": [ "u_monsters_nearby('radius': var_sakuyaradius )", "<", "1" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('stamina')", "+=", "1" ] },
      { "u_add_effect": "sakuya_maidsecret_effect", "duration": "3 s" },
      { "queue_eocs": [ "sakuya_maidsecret_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": [
      { "u_message": "You lose your concentration.", "type": "mixed" },
      { "math": [ "var_sakuyafocus", "=", "0" ] },
      { "u_lose_effect": "sakuya_maidsecret_effect" }
    ]
  },
  {
    "id": "tenko_keystonecrash_eoc",
    "type": "effect_on_condition",
    "condition": "u_is_outside",
    "effect": [
      { "u_cast_spell": { "id": "tenko_keystonecrash2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You need a direct connection to the Heavens to summon a crashing keystone.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ]
  },
  {
    "id": "udonge_disbeliefaspect_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_monsters_nearby('mon_udonge_firing_squad', 'radius': 16, 'attitude': 'friendly')", "==", "0" ] },
    "effect": [
      { "u_cast_spell": { "id": "udonge_disbeliefaspect_spawn" }, "targeted": false }
    ],
    "false_effect": [ 
      { "math": [ "u_val('mana')", "+=", "100" ] },
      { "u_cast_spell": { "id": "udonge_disbeliefaspect_tp" }, "targeted": true }
    ],
    "//": "Simple EOC just checks if there is any Udonge firing squad around. If there isn't then she spawns some and consumes some mana, otherwise she casts the random tp",
    "//2": "Thank you so much andrei8l for #71222"
  },
  {
    "id": "udonge_gunwaveBLAST_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_wielded_with_weapon_category": "AUTOMATIC_PISTOLS" },
    "effect": [
      { "u_cast_spell": { "id": "udonge_gunwaveBLAST2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You don't have any pistols equipped.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ],
    "//": "Simple EOC just checks if Udonge is wielding any pistols, if she isn't the cast fails"
  },
  {
    "id": "udonge_waveinsight_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "+=", "1" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_waveinsight_cycle1" ] }
    ],
    "//": "Adds aura-specific var to signal it is ON, also sets the other auras + bonuses OFF",
    "//2": "Original 'aura', the others are modeled after this"
  },
  {
    "id": "udonge_waveinsight_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveinsight", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_waveinsight_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_waveinsight_toggle" },
    "//": "If Udonge has casted the spell just once the next step is run. However, if the player has casted the spell twice it runs the toggle EOC instead"
  },
  {
    "id": "udonge_waveinsight_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "33" ] },
        { "math": [ "var_waveinsight", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "1" ] },
      { "u_add_effect": "udonge_insight", "duration": "3 s" },
      { "queue_eocs": [ "udonge_waveinsight_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" },
    "//": "Checks if Udonge has enough mana to keep the aura bonus, and reduces mana. If she runs out of mana it runs the oom EOC instead"
  },
  {
    "id": "udonge_waveinsight_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveinsight", ">=", "2" ] },
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" }
    ],
    "//": "Toggle EOC, deactivates the auras when the spell is casted more than once"
  },
  {
    "id": "udonge_wave_oom",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_val('mana')", "<", "33" ] },
    "effect": [
      { "u_message": "You are too mentally exhausted!  You lose focus of the wavelengths.", "type": "bad" },
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" }
    ],
    "//": "oom EOC, resets all aura vars, removes all buffs"
  },
  {
    "id": "udonge_wavemfortitude_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "+=", "1" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_wavemfortitude_cycle1" ] }
    ]
  },
  {
    "id": "udonge_wavemfortitude_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavemfortitude", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_wavemfortitude_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_wavemfortitude_toggle" }
  },
  {
    "id": "udonge_wavemfortitude_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "33" ] },
        { "math": [ "var_wavemfortitude", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "6" ] },
      { "u_add_effect": "udonge_mfortitude", "duration": "3 s" },
      { "queue_eocs": [ "udonge_wavemfortitude_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_wavemfortitude_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavemfortitude", ">=", "2" ] },
    "effect": [
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "u_lose_effect": "udonge_mfortitude" }
    ]
  },
  {
    "id": "udonge_waveperception_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "+=", "1" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_waveperception_cycle1" ] }
    ]
  },
  {
    "id": "udonge_waveperception_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveperception", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_waveperception_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_waveperception_toggle" }
  },
  {
    "id": "udonge_waveperception_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "33" ] },
        { "math": [ "var_waveperception", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "6" ] },
      { "u_add_effect": "udonge_perception", "duration": "3 s" },
      { "queue_eocs": [ "udonge_waveperception_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_waveperception_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveperception", ">=", "2" ] },
    "effect": [
      { "math": [ "var_waveperception", "=", "0" ] },
      { "u_lose_effect": "udonge_perception" }
    ]
  },
  {
    "id": "udonge_wavestealth_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "+=", "1" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "run_eocs": [ "udonge_wavestealth_cycle1" ] }
    ]
  },
  {
    "id": "udonge_wavestealth_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavestealth", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_wavestealth_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_wavestealth_toggle" }
  },
  {
    "id": "udonge_wavestealth_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "33" ] },
        { "math": [ "var_wavestealth", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "10" ] },
      { "u_add_effect": "udonge_stealth", "duration": "3 s" },
      { "queue_eocs": [ "udonge_wavestealth_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_wavestealth_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavestealth", ">=", "2" ] },
    "effect": [
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_stealth" }
    ]
  },
  {
    "id": "utsuho_blacksun_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_blacksun2" } }
    ],
    "false_effect": [ 
      { "u_cast_spell": { "id": "utsuho_blacksun2_unc" } },
      { "math": [ "u_val('mana')", "-=", "50" ] }
    ]
  },
  {
    "id": "utsuho_detectrad_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_detectrad2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "Something's wrongâ€¦ you cannot detect anything.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "rand(50)" ] }
    ]
  },
  {
    "id": "utsuho_fissionaura_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_utsuho_fissionaura", "+=", "1" ] },
      { "run_eocs": [ "utsuho_fissionaura_cycle1" ] }
    ],
    "//": "This EOC is a modified version of udonge_waveinsight_start . It has an extra step that checks if Utsuho is wearing her rod, if she isn't it runs a sub-cycle with different values"
  },
  {
    "id": "utsuho_fissionaura_cycle1",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "run_eocs": [ "utsuho_fissionaura_cycle2" ] }
    ],
    "false_effect": [ { "run_eocs": [ "utsuho_fissionaura_cycle2_unc" ] } ]
  },
  {
    "id": "utsuho_fissionaura_cycle2",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fissionaura", "<", "2" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "utsuho_fissionaura2" }, "targeted": false },
      { "run_eocs": [ "utsuho_fissionaura_cycle3" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_toggle" }
  },
  {
    "id": "utsuho_fissionaura_cycle3",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "11" ] },
        { "math": [ "var_utsuho_fissionaura", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "11" ] },
      { "queue_eocs": [ "utsuho_fissionaura_cycle1" ], "time_in_future": "3 s" }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_oom" }
  },
  {
    "id": "utsuho_fissionaura_cycle2_unc",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fissionaura", "<", "2" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "utsuho_fissionaura2_unc" }, "targeted": false },
      { "run_eocs": [ "utsuho_fissionaura_cycle3_unc" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_toggle" }
  },
  {
    "id": "utsuho_fissionaura_cycle3_unc",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "11" ] },
        { "math": [ "var_utsuho_fissionaura", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "11 + rand(6)" ] },
      { "queue_eocs": [ "utsuho_fissionaura_cycle1" ], "time_in_future": [ "2 s", "4 s" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_oom" }
  },
  {
    "id": "utsuho_fissionaura_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fissionaura", ">=", "2" ] },
    "effect": [
      { "u_message": "You return the fission controllers to base operational levels.", "type": "mixed" },
      { "math": [ "var_utsuho_fissionaura", "=", "0" ] }
    ]
  },
  {
    "id": "utsuho_fissionaura_oom",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_val('mana')", "<", "11" ] },
    "effect": [
      { "u_message": "You ran out of energy!  The fission controllers default to base operational levels.", "type": "mixed" },
      { "math": [ "var_utsuho_fissionaura", "=", "0" ] }
    ]
  },
  {
    "id": "utsuho_fusionblade_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_utsuho_fusionblade", "+=", "1" ] },
      { "run_eocs": [ "utsuho_fusionblade_cycle1" ] }
    ],
    "//": "This EOC is a modified version of udonge_waveinsight_start . It has an extra step to check if Utsuho is wearing her rod"
  },
  {
    "id": "utsuho_fusionblade_cycle1",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [ { "run_eocs": [ "utsuho_fusionblade_cycle2" ] } ],
    "false_effect": [ { "run_eocs": [ "utsuho_fusionblade_unequipped" ] } ]
  },
  {
    "id": "utsuho_fusionblade_cycle2",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fusionblade", "<", "2" ] },
    "effect": [ { "run_eocs": [ "utsuho_fusionblade_cycle3" ] } ],
    "false_effect": { "run_eocs": "utsuho_fusionblade_toggle" },
    "//IMPORTANT": "The toggle doesn't stop here, it runs cycle1 and cycle2 one more time before stopping (set debug u_message to each effect and run it ingame to understand)",
    "//IMPORTANT2": "I think this happens with all 'auras' set up the same way. Udonge's 'wave' auras have the same problem",
    "//IMPORTANT3": "My guess is that happens due the queue'd EOC running one more time. The > 0 check in the next EOC is what actually stops the momentum. DO NOT REMOVE BEFORE FINDING A SOLUTION",
    "//IMPORTANT4": "I tried my best in trying to simplify all the cycle1 - cycle2 based EOCs but couldn't find a solution. Maybe in the future, idk these work as they are"
  },
  {
    "id": "utsuho_fusionblade_cycle3",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "2" ] },
        { "math": [ "var_utsuho_fusionblade", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "2" ] },
      { "u_add_effect": "aura_fusionblade", "duration": "2 s" },
      { "queue_eocs": [ "utsuho_fusionblade_cycle1" ], "time_in_future": "1 s" }
    ],
    "false_effect": { "run_eocs": "utsuho_fusionblade_oom" },
    "//": "-2 mana/s equals +8 min of keeping this active"
  },
  {
    "id": "utsuho_fusionblade_unequipped",
    "type": "effect_on_condition",
    "effect": [
      { "u_message": "You unequip your rod, extinguishing the blade.", "type": "mixed" },
      { "math": [ "var_utsuho_fusionblade", "=", "0" ] },
      { "u_lose_effect": "aura_fusionblade" }
    ]
  },
  {
    "id": "utsuho_fusionblade_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fusionblade", ">=", "2" ] },
    "effect": [
      { "u_message": "You deactivate the fusion blade.", "type": "mixed" },
      { "math": [ "var_utsuho_fusionblade", "=", "0" ] },
      { "u_lose_effect": "aura_fusionblade" }
    ]
  },
  {
    "id": "utsuho_fusionblade_oom",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_val('mana')", "<", "2" ] },
    "effect": [
      { "u_message": "You ran out of energy! The fusion blade is extinguished.", "type": "bad" },
      { "math": [ "var_utsuho_fusionblade", "=", "0" ] },
      { "u_lose_effect": "aura_fusionblade" }
    ]
  },
  {
    "id": "utsuho_groundmelt_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_groundmelt2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You need to equip your third rod to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "266" ] }
    ]
  },
  {
    "id": "utsuho_minisun_follow",
    "type": "effect_on_condition",
    "//recurrence": "1 s",
    "condition": {
      "and": [
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 99, 'attitude': 'friendly')", ">", "0" ] },
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 5, 'attitude': 'friendly')", "==", "0" ] }
      ]
    },
    "deactivate_condition": {
      "or": [
        { "not": { "u_has_trait": "PROF_OKUU" } },
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 99, 'attitude': 'friendly')", "==", "0" ] }
      ]
    },
    "effect": [ 
      { "u_cast_spell": { "id": "utsuho_blacksun2" }, "targeted": false }
    ],
    "//": "WIP"
  },
  {
    "id": "utsuho_nuke_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_nuke2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You *definitely* need your rod to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "800" ] }
    ],
    "//": "Does she? :^)"
  },
  {
    "id": "utsuho_ugeyser_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_ugeyser2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_cast_spell": { "id": "utsuho_ugeyser2_unc" }, "targeted": true },
      { "math": [ "u_val('mana')", "-=", "50" ] }
    ]
  },
  {
    "id": "yamame_disease_epidemic_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "run_eocs": [ "yamame_disease_epidemic_1" ] },
      { "run_eocs": [ "yamame_disease_epidemic_2" ] },
      { "run_eocs": [ "yamame_disease_epidemic_3" ] }
    ],
    "//": "Subspell that act as a repeater for each of her spells, by separate. The u_var_whatever are set at yamame_opens_spellbook_eoc "
  },
  {
    "id": "yamame_disease_epidemic_1",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_icypyrexia", ">=", "1" ] },
    "effect": [
      { "math": [ "u_var_icypyrexia", "=", "0" ] },
      { "u_cast_spell": { "id": "yamame_disease_icypyrexia3" } }
    ]
  },
  {
    "id": "yamame_disease_epidemic_2",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_scarletplague", ">=", "1" ] },
    "effect": [
      { "math": [ "u_var_scarletplague", "=", "0" ] },
      { "u_cast_spell": { "id": "yamame_disease_scarletplague3" } }
    ]
  },
  {
    "id": "yamame_disease_epidemic_3",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_var_unconstrainedrot", ">=", "1" ] },
    "effect": [
      { "math": [ "u_var_unconstrainedrot", "=", "0" ] },
      { "u_cast_spell": { "id": "yamame_disease_unconstrainedrot4" } }
    ]
  },
  {
    "id": "yamame_disease_icypyrexia_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_icypyrexia", "+=", "1" ] }
    ]
  },
  {
    "id": "yamame_disease_scarletplague_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_scarletplague", "+=", "1" ] }
    ]
  },
  {
    "id": "yamame_disease_unconstrainedrot_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_unconstrainedrot", "+=", "1" ] }
    ]
  },
  {
    "id": "yamame_damnedrope_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_add_trait": "damnedrope_strength_mut" },
      { "queue_eocs": [ "yamame_damnedrope_end" ], "time_in_future": "1 s" }
    ]
  },
  {
    "id": "yamame_damnedrope_end",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "yamame_damnedrope2" }, "targeted": true },
      { "u_lose_trait": "damnedrope_strength_mut" }
    ]
  },
  {
    "id": "youmu_slasheternal_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "JAPANESE_SWORDS" },
        { "u_has_wielded_with_weapon_category": "SHORT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "MEDIUM_SWORDS" },
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "FENCING_WEAPONRY" },
        { "u_has_wielded_with_weapon_category": "LONG_THRUSTING_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "BIONIC_SWORDS" }
      ]
    },
    "effect": [
      { "run_eocs": [ "youmu_slasheternal_check" ] }
    ],
    "false_effect": [ 
      { "u_message": "You need a sword to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "100" ] }
    ],
    "//": "This EOC is a simplified version of kokoro_backsweep_eoc "
  },
  {
    "id": "youmu_slasheternal_check",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "youmu_slasheternal2_cut" }, "targeted": true }
    ],
    "false_effect": [ { "u_cast_spell": { "id": "youmu_slasheternal2_bash" }, "targeted": true } ]
  },
  {
    "id": "youmu_slashnether_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "JAPANESE_SWORDS" },
        { "u_has_wielded_with_weapon_category": "SHORT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "MEDIUM_SWORDS" },
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "FENCING_WEAPONRY" },
        { "u_has_wielded_with_weapon_category": "LONG_THRUSTING_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "BIONIC_SWORDS" }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "youmu_slashnether2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You need a sword to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "100" ] }
    ],
    "//": "This EOC is a simplified version of kokoro_backsweep_eoc "
  }
]
